\documentclass[12pt]{beamer}\usepackage[]{graphicx}\usepackage[]{color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
%\documentclass[10pt,handout,english]{beamer}
\usetheme{Air}
\usepackage{thumbpdf}
\usepackage{wasysym}
\usepackage{ucs}
\usepackage[utf8]{inputenc}
\usepackage{pgf,pgfarrows,pgfnodes,pgfautomata,pgfheaps,pgfshade}
\usepackage{verbatim}
\usepackage{comment}
\usepackage{listings,relsize} 
\lstloadlanguages{R} 


\geometry{paperwidth=160mm,paperheight=105mm}
\usepackage{pgfpages}

\usepackage{lipsum}

\pdfinfo
{
  /Title       (Data manipulation in R: a program to use when size matters)
  /Creator     (Peter Shaw)
  /Author      (Peter Shaw)
}
%\pgfpagesuselayout{4 on 1}[a4paper,border shrink=5mm,landscape]
%\pgfpagesuselayout{2 on 1}[a4paper,border shrink=5mm,landscape]
\title{Data manipulation in R}
\subtitle{A program to use when size matters}
\author{Peter Shaw}

%-------------------------------------------------------------------------------------
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}
\lstset{language=R,basicstyle=\smaller[2]%}
,commentstyle=\rmfamily\smaller,  showstringspaces=false,
xleftmargin=4ex,literate={<-}{{$\leftarrow$}}1 {~}{{$\sim$}}1} 
\lstset{escapeinside={(*}{*)}}   % for (*\ref{ }*) inside lstlistings (S code) 
\linewidth=325pt
\frame{\titlepage}
%^\end{frame}

\section*{}
\AtBeginSection[]
{
\begin{frame}
  \frametitle{Outline}
  \tableofcontents[section=1,hidesubsections]
  %\tableofcontents
\end{frame}
}

%\AtBeginSection[]
%{
%  \frame<handout:0>
%  {
%    \frametitle{Outline}
%    \tableofcontents[currentsection,hideallsubsections]
%  }
%}
%\AtBeginSubsection[]
%{
%  \frame<handout:0>
%  {
%    \frametitle{Outline}
%    \tableofcontents[sectionstyle=show/hide,subsectionstyle=show/shaded/hide]
%  }
%}

\newcommand<>{\highlighton}[1]{%
  \alt#2{\structure{#1}}{{#1}}
}

\newcommand{\icon}[1]{\pgfimage[height=1em]{#1}}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%% Content starts here %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section*{Introduction}
%\begin{frame}
%  \vfill
%  \centering
%  \highlighton{
%  \usebeamerfont*{frametitle}A common scenario
%  \usebeamerfont*{framesubtitle}A friend has emailed you her data in a spreadsheet
  
%  \vfill
%\end{frame}


\begin{frame}
  \frametitle{Why use R?}
  \framesubtitle{Why not use a spreadsheet?}

  \begin{block}{Why not use a spreadsheet?}
  \begin{itemize}
    \item Data manipulation in Excel is VERY risk and time consuming
    \item A rage of software packages are available for Excel
    \item Large data sets can exceed the size limits of standard programs
    \item Spreadsheets don't have the inherent understanding of statistics that R has
    \item For example handling of N\/A's
    \item R is hot!
  \end{itemize}
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{Why use R?}
  \begin{block}{Why use R?}
  \begin{itemize}
    \item Its free
    \item Its available on most operating systems Windows, OS X, Linux
    \item There are huge numbers of packages available
    \item Its becoming the international standard for statistics
  \end{itemize}
  \end{block}
\end{frame}

%@book{Teetor:2011:RC:2011867,
% author = {Teetor, Paul},
% title = {R Cookbook},
% year = {2011},
% isbn = {0596809158, 9780596809157},
% edition = {1st},
% publisher = {O'Reilly Media, Inc.},
%} 

\begin{frame}[allowframebreaks]
\frametitle{Getting Started}
  \framesubtitle{Some References}
  \begin{thebibliography}{10}    
  \setbeamertemplate{bibliography item}[book]
  \bibitem{Teetor:2011:RC:2011867}
    James P. Howard.
    \newblock {\em R Cookbook}.
    \newblock O'Reilly Media, Inc, 2011.
 
  \setbeamertemplate{bibliography item}[book]
  \bibitem{Jemand2000}
    Phil Spector.
    \newblock {\em Data Manipulation with R.}
    \newblock Use R series 
    \newblock Springer, 2008
    
%@book{R:Spector:2008,
%  author = {Phil Spector},
%  title = {Data Manipulation with R},
%  publisher = {Springer},
%  year = {2008}
%}   
%  \setbeamertemplate{bibliography item}[article]
%  \bibitem{Jemand2000}
%    Phil Spector.
%    \newblock {\em Data Manipulation with R.}
%    \item Use R series 
%    \newblock Springer, 2008
%https://cran.r-project.org/doc/manuals/R-intro.pdf
  \end{thebibliography}
\end{frame}


\begin{frame}
  \frametitle{Getting Started}
  \framesubtitle{Installing R!}

  \begin{block}{Download it}
  \begin{itemize}
    \item Open {\url http://www.r-project.org}
    \item Click CRAN (Under download on Top Left)
    \item Click {\url http://cran.ms.unimelb.edu.au/} University of Melbourne
  \end{itemize}
  \end{block}

  \begin{block}{Windows}
  \begin{itemize}
    \item Select Windows
    \item Select Base
    \item Download R (suggest latest version)
  \end{itemize}
  \end{block}

  \begin{block}{OS X}
  \begin{itemize}
    \item Select Select OS X
    \item Select R-3.2.2.pkg (or the version that matches your OS version)
  \end{itemize}
  \end{block}

\end{frame}

\begin{frame}{Getting Started}
\framesubtitle{Installing a GUI}
\begin{block}{How about RStudio}
{\url https://www.rstudio.com/products/rstudio/download/}
\end{block}

\end{frame}

\begin{frame}[fragile, allowframebreaks]
  \frametitle{Getting Started}
  \framesubtitle{Basic steps}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlnum{2}\hlopt{+}\hlnum{5}
\end{alltt}
\begin{verbatim}
## [1] 7
\end{verbatim}
\begin{alltt}
\hlcom{# Create a sequence of numbers}
\hlstd{X} \hlkwb{=} \hlnum{2}\hlopt{:}\hlnum{10}

\hlcom{# Display basic statistical measures}
\hlkwd{summary}\hlstd{(X)}
\end{alltt}
\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##       2       4       6       6       8      10
\end{verbatim}
\begin{alltt}
\hlcom{# use q() to quit}
\end{alltt}
\end{kframe}
\end{knitrout}
\clearpage
\end{frame}

\begin{frame}[fragile, allowframebreaks]
  \frametitle{Getting Started}
  \framesubtitle{Help Functions}
\begin{block}{To access the documentation type}
\end{block}
\begin{lstlisting} 
help.start()
help(summary)
args(summary)
example(sd)
\end{lstlisting} 
\clearpage
\end{frame}

\begin{frame}
  \frametitle{Help Functions}
  \framesubtitle{Search the Web}
\begin{block}{To search R documentation}
RSiteSearch("key phrase")
%help(adf.test,package="tseries")
%to search for a tutorial for a package
%vignette(package="packagename")
%For an intro to vignettes see
%https://cran.r-project.org/web/packages/sos/vignettes/sos.pdf
%examples on the web
%http://shiny.rstudio.com/gallery/
\end{block}
\begin{block}{Custom Google search focused on R-specific websites}
{\url http://rseek.org}
\end{block}

\begin{block}{Coding Q\&A site}
{\url http://stackoverflow.com}
{\url http://stats.stakexchange.com}
\end{block}

\end{frame}

\section*{Some manners}
\begin{frame}
  \frametitle{Iterative development}
  \framesubtitle{Working Creatively}
Some discussion recently on how to work creatively. Research out of  successful R\&D projects developed into Agile
\begin{itemize}
\item Keep the manages away
\item work sustainably
\item people over process
\item iterative development
\end{itemize}
\end{frame}

\section*{R Data types}
\begin{frame}
  \frametitle{R Data types}
  \framesubtitle{Lists, frames and tables}
  \begin{block}{Lists}
      \begin{itemize}
         \item $l=c(1,3,4)$
         \item $bbb$
      \end{itemize}
  \end{block}
\end{frame}  

\section*{Reading our file}
\begin{frame}[fragile, allowframebreaks]
  \frametitle{Lets read the table}
  \framesubtitle{Check the current directory}
\begin{block}{Where are we}
\begin{lstlisting} 
getwd()
setwd("/Users/pcru")
dir() #This lists the files
ls()  #This lists the variables
\end{lstlisting}
{\url http://www.statmethods.net/input/contents.html}
\end{block}
\end{frame}

\begin{frame}[fragile, allowframebreaks]
  \frametitle{Lets read the table}
  \framesubtitle{Reading a table}
\begin{block}{To read a csv table as a table try}
\begin{lstlisting} 
tab1 <- as.matrix(read.csv(file="filetable.csv", sep=",", header=FALSE))
\end{lstlisting}
\end{block}
\begin{block}{But our table is an excel file}
\begin{itemize}
\item What about a package?
\item {\url http://www.thertrader.com/2014/02/11/a-million-ways-to-connect-r-and-excel/}
\item Lets use the R package xlsx
\end{itemize}
\end{block}
\end{frame}

\section*{Getting help on packages}
\begin{frame}[fragile, allowframebreaks]
  \frametitle{R Packages}
  \framesubtitle{CRAN}
  
   \begin{block}{Where from}
  \begin{itemize} 
  \item install command
  \item $install.packages(pkgs)$
  \end{itemize}
  \end{block}
  
  \begin{block}{Citing Packages}
%  \begin{itemize}
%  \item Citing packages

%  x<-citation()
%  toBibtex(x)
%See also url 
{\url https://cran.r-project.org/web/packages/RefManageR/vignettes/TestRmd.html}
%  \end{itemize}
  \end{block}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
 \hlstd{x}\hlkwb{<-}\hlkwd{citation}\hlstd{()}
 \hlkwd{toBibtex}\hlstd{(x)}
\end{alltt}
\begin{verbatim}
## @Manual{,
##   title = {R: A Language and Environment for Statistical Computing},
##   author = {{R Core Team}},
##   organization = {R Foundation for Statistical Computing},
##   address = {Vienna, Austria},
##   year = {2014},
##   url = {http://www.R-project.org/},
## }
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile, allowframebreaks]
  \frametitle{Lets read the table}
  \framesubtitle{An example}
\begin{lstlisting} 
table1<-read.xlsx2("1_R Wkshp_dummy data_OTU table.xlsx", sheetName = 

"Sheet1",header=FALSE,rowNames=FALSE,transpose=TRUE,endRow=18)
\end{lstlisting}
  
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Loading required package: xlsx}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning: package 'xlsx' was built under R version 3.1.3}}

{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Loading required package: rJava}}

{\ttfamily\noindent\color{warningcolor}{\#\# Warning: package 'rJava' was built under R version 3.1.3}}

{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Loading required package: methods\\\#\# Loading required package: xlsxjars\\\#\# Loading required package: xtable}}\end{kframe}
\end{knitrout}

% latex table generated in R 3.1.2 by xtable 1.7-4 package
% Sat Sep 19 22:58:21 2015
\begin{table}[ht]
\centering
\begin{tabular}{rlllllll}
  \hline
 & X1 & X2 & X3 & X4 & X5 & X6 & X7 \\ 
  \hline
1 & Group & Contaminated &  &  &  &  &  \\ 
  2 & Site & 1 &  &  & 2 &  &  \\ 
  3 & Sample ID & 10000 & 10001 & 10002 & 10003 & 10004 & 10005 \\ 
  4 & Rep & 1 & 2 & 3 & 1 & 2 & 3 \\ 
  5 & phormidiaceae & 24872 & 24872 & 5822 & 7538 & 7201 & 7538 \\ 
  6 & streptococcaceae & 11 & 7 & 14 & 8 & 10 & 8 \\ 
   \hline
\end{tabular}
\end{table}

\clearpage
\end{frame}

\begin{frame}[fragile, allowframebreaks]
  \frametitle{Lets read the table}
  \framesubtitle{Transpose the table}
  \begin{block}{Transposing}
  We need to transpose the table and set the column names correctly
  \end{block}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{table1t}\hlkwb{=}\hlkwd{setNames}\hlstd{(}\hlkwd{data.frame}\hlstd{(}\hlkwd{t}\hlstd{(table1[,}\hlopt{-}\hlnum{1}\hlstd{])),table1[,}\hlnum{1}\hlstd{])}
\hlstd{ctridx}\hlkwb{<-}\hlkwd{which}\hlstd{(table1t}\hlopt{$}\hlstd{Group}\hlopt{==}\hlstr{"Control"}\hlstd{)}
\hlstd{table1t}\hlopt{$}\hlstd{Group[}\hlnum{1}\hlopt{:}\hlnum{48}\hlstd{]}\hlkwb{<-}\hlstr{"Contaminated"}
\hlstd{table1t}\hlopt{$}\hlstd{Group[(ctridx}\hlopt{+}\hlnum{1}\hlstd{)}\hlopt{:}\hlnum{48}\hlstd{]}\hlkwb{<-}\hlstr{"Control"}
\end{alltt}
\end{kframe}
\end{knitrout}
\begin{lstlisting}
ttt<-table1t$Site
for(i in c(2:length(table1t$Site)))
{
	temp<-as.character(table1t$Site[i])
	tempb<-as.character(ttt[i-1])
	if(table1t$Site[i]=="") 
	{
		 ttt[i]<-tempb
 	}
	if(!table1t$Site[(i)]=="")
	{
		ttt[i]<-temp
	}
}
table1t$Site<-ttt
\end{lstlisting}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{verbatim}
## X3 
##  1 
## Levels:  1 2 3 4 FALSE TRUE
## X4 
##  1 
## Levels:  1 2 3 4 FALSE TRUE
## X5 
##  2 
## Levels:  1 2 3 4 FALSE TRUE
## X6 
##  2 
## Levels:  1 2 3 4 FALSE TRUE
## X7 
##  2 
## Levels:  1 2 3 4 FALSE TRUE
## X8 
##  1 
## Levels:  1 2 3 4 FALSE TRUE
## X9 
##  1 
## Levels:  1 2 3 4 FALSE TRUE
## X10 
##   1 
## Levels:  1 2 3 4 FALSE TRUE
## X11 
##   2 
## Levels:  1 2 3 4 FALSE TRUE
## X12 
##   2 
## Levels:  1 2 3 4 FALSE TRUE
## X13 
##   2 
## Levels:  1 2 3 4 FALSE TRUE
## X14 
##   1 
## Levels:  1 2 3 4 FALSE TRUE
## X15 
##   1 
## Levels:  1 2 3 4 FALSE TRUE
## X16 
##   1 
## Levels:  1 2 3 4 FALSE TRUE
## X17 
##   2 
## Levels:  1 2 3 4 FALSE TRUE
## X18 
##   2 
## Levels:  1 2 3 4 FALSE TRUE
## X19 
##   2 
## Levels:  1 2 3 4 FALSE TRUE
## X20 
##   1 
## Levels:  1 2 3 4 FALSE TRUE
## X21 
##   1 
## Levels:  1 2 3 4 FALSE TRUE
## X22 
##   1 
## Levels:  1 2 3 4 FALSE TRUE
## X23 
##   2 
## Levels:  1 2 3 4 FALSE TRUE
## X24 
##   2 
## Levels:  1 2 3 4 FALSE TRUE
## X25 
##   2 
## Levels:  1 2 3 4 FALSE TRUE
## X26 
##   3 
## Levels:  1 2 3 4 FALSE TRUE
## X27 
##   3 
## Levels:  1 2 3 4 FALSE TRUE
## X28 
##   3 
## Levels:  1 2 3 4 FALSE TRUE
## X29 
##   4 
## Levels:  1 2 3 4 FALSE TRUE
## X30 
##   4 
## Levels:  1 2 3 4 FALSE TRUE
## X31 
##   4 
## Levels:  1 2 3 4 FALSE TRUE
## X32 
##   3 
## Levels:  1 2 3 4 FALSE TRUE
## X33 
##   3 
## Levels:  1 2 3 4 FALSE TRUE
## X34 
##   3 
## Levels:  1 2 3 4 FALSE TRUE
## X35 
##   4 
## Levels:  1 2 3 4 FALSE TRUE
## X36 
##   4 
## Levels:  1 2 3 4 FALSE TRUE
## X37 
##   4 
## Levels:  1 2 3 4 FALSE TRUE
## X38 
##   3 
## Levels:  1 2 3 4 FALSE TRUE
## X39 
##   3 
## Levels:  1 2 3 4 FALSE TRUE
## X40 
##   3 
## Levels:  1 2 3 4 FALSE TRUE
## X41 
##   4 
## Levels:  1 2 3 4 FALSE TRUE
## X42 
##   4 
## Levels:  1 2 3 4 FALSE TRUE
## X43 
##   4 
## Levels:  1 2 3 4 FALSE TRUE
## X44 
##   3 
## Levels:  1 2 3 4 FALSE TRUE
## X45 
##   3 
## Levels:  1 2 3 4 FALSE TRUE
## X46 
##   3 
## Levels:  1 2 3 4 FALSE TRUE
## X47 
##   4 
## Levels:  1 2 3 4 FALSE TRUE
## X48 
##   4 
## Levels:  1 2 3 4 FALSE TRUE
## X49 
##   4 
## Levels:  1 2 3 4 FALSE TRUE
## rowNames 
##    FALSE 
## Levels:  1 2 3 4 FALSE TRUE
## transpose 
##      TRUE 
## Levels:  1 2 3 4 FALSE TRUE
\end{verbatim}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Loading required package: stringr}}\end{kframe}
\end{knitrout}

%{\url http://rgm3.lab.nig.ac.jp/RGM/R_rdfile?f=Ecdat/man/read.transpose.Rd&d=R_CC}
{\url http://stackoverflow.com/questions/17288197/reading-a-csv-file-organized-horizontally}
% latex table generated in R 3.1.2 by xtable 1.7-4 package
% Sat Sep 19 22:58:21 2015
\begin{table}[ht]
\centering
\begin{tabular}{rlllll}
  \hline
 & Group & Site & Sample ID & Rep & phormidiaceae \\ 
  \hline
X2 & Contaminated & 1 & 10000 & 1 & 24872 \\ 
  X3 & Contaminated & 1 & 10001 & 2 & 24872 \\ 
  X4 & Contaminated & 1 & 10002 & 3 & 5822 \\ 
  X5 & Contaminated & 2 & 10003 & 1 & 7538 \\ 
  X6 & Contaminated & 2 & 10004 & 2 & 7201 \\ 
  X7 & Contaminated & 2 & 10005 & 3 & 7538 \\ 
   \hline
\end{tabular}
\end{table}
% latex table generated in R 3.1.2 by xtable 1.7-4 package
% Sat Sep 19 22:58:21 2015
\begin{table}[ht]
\centering
\begin{tabular}{rlllll}
  \hline
 &          Group &    Site &   Sample ID &    Rep & phormidiaceae \\ 
  \hline
1 &             : 0   &      : 0   & 10003  : 3   & 1    :16   & 115    : 2   \\ 
  2 & Contaminated:25   & 1    :12   & 10004  : 3   & 2    :16   & 24872  : 2   \\ 
  3 & Control     :23   & 2    :12   & 10005  : 3   & 3    :16   & 33     : 2   \\ 
  4 & FALSE       : 1   & 3    :12   & 10006  : 3   & F1LSE: 1   & 36     : 2   \\ 
  5 & TRUE        : 1   & 4    :12   & 10007  : 3   & TRUE : 1   & 7538   : 2   \\ 
  6 &  & FALSE: 1   & 10008  : 3   &  & 800    : 2   \\ 
  7 &  & TRUE : 1   & (Other):32   &  & (Other):38   \\ 
   \hline
\end{tabular}
\end{table}

\clearpage
\end{frame}

\begin{frame}[fragile, allowframebreaks]
  \frametitle{Lets read the table}
  \framesubtitle{Reading a table}
\begin{itemize}  
\item {\url http://www.statmethods.net/input/importingdata.html}
\item Input files from Stata
%table1<-read.xlsx2("1_R Wkshp_dummy data_OTU table.xlsx", sheetName = "Sheet1",header=FALSE,rowNames=TRUE)
%http://stackoverflow.com/questions/17288197/reading-a-csv-file-organized-horizontally
%http://rgm3.lab.nig.ac.jp/RGM/R_rdfile?f=Ecdat/man/read.transpose.Rd&d=R_CC
\end{itemize}
\begin{lstlisting} 
library(foreign)
mydata <- read.dta("c:/mydata.dta")  
\end{lstlisting} 
\end{frame}

\section*{Working with Data Types}
\begin{frame}[fragile, allowframebreaks]
  \frametitle{Lets read the next table}
  \framesubtitle{Reading a table using xlxs}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{setwd}\hlstd{(}\hlstr{"/Users/pcru/SizeDoesMatter1"}\hlstd{)}
\hlcom{#dir()}
\hlstd{table2}\hlkwb{<-}\hlkwd{read.xlsx2}\hlstd{(}\hlstr{"2_R Wkshp_dummy data_Env Data.xlsx"}\hlstd{,} \hlkwc{sheetName} \hlstd{=}\hlstr{"Sheet2"}\hlstd{,}\hlkwc{header}\hlstd{=}\hlnum{TRUE}\hlstd{,}\hlkwc{rowNames}\hlstd{=}\hlnum{FALSE}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
% latex table generated in R 3.1.2 by xtable 1.7-4 package
% Sat Sep 19 22:58:21 2015
\begin{table}[ht]
\centering
\begin{tabular}{rlllll}
  \hline
 & Group & Site & Sample.ID & Rep & Spill.date \\ 
  \hline
1 & Contaminated & 1 & 10000 & 1 & 14-May-14 \\ 
  2 & Contaminated & 1 & 10001 & 2 & 14-May-14 \\ 
  3 & Contaminated & 1 & 10002 & 3 & 14-May-14 \\ 
  4 & Contaminated & 2 & 10003 & 1 & 14-May-14 \\ 
  5 & Contaminated & 2 & 10004 & 2 & 14-May-14 \\ 
  6 & Contaminated & 2 & 10005 & 3 & 14-May-14 \\ 
   \hline
\end{tabular}
\end{table}

%print(xtable(summary(table1t[,1:5])))
\clearpage
\end{frame}

%https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html
%In tidy data:
%\begin{itemize}
%\item Each variable forms a column.
%\item Each observation forms a row.
%\item Each type of observational unit forms a table.
%http://pj.freefaculty.org/R/Rtips.html#toc-Subsection-1.11
%\end{itemize}

\begin{frame}[fragile, allowframebreaks]
  \frametitle{Lets read the next table}
  \framesubtitle{Reading a table}
%<<chunk7ii, echo=TRUE>>=
%print(xtable(str(table2)))
%@
\begin{alert}{Oh NO}
All columns have been set to factors
\end{alert}

\begin{block}{lets break it down}
First lets reed a few rows only
\end{block}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{table2}\hlkwb{<-}\hlkwd{read.xlsx2}\hlstd{(}\hlstr{"2_R Wkshp_dummy data_Env Data.xlsx"}\hlstd{,} \hlkwc{sheetName} \hlstd{=} \hlstr{"Sheet2"}\hlstd{,}\hlkwc{header}\hlstd{=}\hlnum{TRUE}\hlstd{,}\hlkwc{rowNames}\hlstd{=}\hlnum{FALSE}\hlstd{,}\hlkwc{as.Data.frame}\hlstd{=}\hlnum{FALSE}\hlstd{,}\hlkwc{colIndex}\hlstd{=}\hlkwd{c}\hlstd{(}\hlnum{1}\hlopt{:}\hlnum{5}\hlstd{),}\hlkwc{stringsAsFactors}\hlstd{=}\hlnum{FALSE}\hlstd{,}\hlkwc{colClasses}\hlstd{=}\hlkwd{c}\hlstd{(}\hlstr{"character"}\hlstd{,}\hlstr{"numeric"}\hlstd{,}\hlstr{"numeric"}\hlstd{,}\hlkwd{rep}\hlstd{(}\hlstr{"character"}\hlstd{,}\hlnum{2}\hlstd{)),}\hlkwc{endRow}\hlstd{=}\hlnum{4}\hlstd{)}
\hlkwd{sapply}\hlstd{(table2,mode)}
\end{alltt}
\begin{verbatim}
##         Group          Site     Sample.ID           Rep    Spill.date 
##   "character"     "numeric"     "numeric"   "character"   "character" 
##      rowNames as.Data.frame 
##     "logical"     "logical"
\end{verbatim}
\begin{alltt}
\hlkwd{sapply}\hlstd{(table2,class)}
\end{alltt}
\begin{verbatim}
##         Group          Site     Sample.ID           Rep    Spill.date 
##   "character"     "numeric"     "numeric"   "character"   "character" 
##      rowNames as.Data.frame 
##     "logical"     "logical"
\end{verbatim}
\end{kframe}
\end{knitrout}
\clearpage
\end{frame}

\begin{frame}[fragile, allowframebreaks]
  \frametitle{Lets read the next table}
  \framesubtitle{Setting the data types}
\begin{block}{colClasses}
\begin{itemize}
\item The variable colClasses can be used to specify the row types.
\item We need to set stringsAsFactor=FALSE or all columns with be loaded as factors
\item The dates are in a non standard format so we need to read them as chars first
\end{itemize}
\end{block}
%#table2<-read.xlsx2("2_R Wkshp_dummy data_Env Data.xlsx", sheetName = #"Sheet2",header=TRUE,rowNames=FALSE,as.Data.frame=FALSE,colIndex=c(1:11),stringsAsFactors=FALSE,col#Classes=c("character",rep("numeric",3),rep("character",2),rep("numeric",6)),endRow=4)
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{table2b}\hlkwb{<-}\hlkwd{read.xlsx2}\hlstd{(}\hlstr{"2_R Wkshp_dummy data_Env Data.xlsx"}\hlstd{,} \hlkwc{sheetName} \hlstd{=} \hlstr{"Sheet2"}\hlstd{,}\hlkwc{header}\hlstd{=}\hlnum{TRUE}\hlstd{,}\hlkwc{rowNames}\hlstd{=}\hlnum{FALSE}\hlstd{,}\hlkwc{as.Data.frame}\hlstd{=}\hlnum{FALSE}\hlstd{,}\hlkwc{colIndex}\hlstd{=}\hlkwd{c}\hlstd{(}\hlnum{1}\hlopt{:}\hlnum{11}\hlstd{),}\hlkwc{stringsAsFactors}\hlstd{=}\hlnum{FALSE}\hlstd{,}\hlkwc{colClasses}\hlstd{=}\hlkwd{c}\hlstd{(}\hlstr{"character"}\hlstd{,}\hlkwd{rep}\hlstd{(}\hlstr{"numeric"}\hlstd{,}\hlnum{2}\hlstd{),}\hlstr{"character"}\hlstd{,}\hlkwd{rep}\hlstd{(}\hlstr{"character"}\hlstd{,}\hlnum{2}\hlstd{),}\hlkwd{rep}\hlstd{(}\hlstr{"numeric"}\hlstd{,}\hlnum{6}\hlstd{)))}
\hlkwd{sapply}\hlstd{(table2,class)}
\end{alltt}
\begin{verbatim}
##         Group          Site     Sample.ID           Rep    Spill.date 
##   "character"     "numeric"     "numeric"   "character"   "character" 
##      rowNames as.Data.frame 
##     "logical"     "logical"
\end{verbatim}
\end{kframe}
\end{knitrout}
\clearpage
\end{frame}

\begin{frame}[fragile, allowframebreaks]
  \frametitle{Lets read the next table}
  \framesubtitle{Setting the Date Type}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{table2f}\hlkwb{<-}\hlstd{table2}
\hlstd{table2f}\hlopt{$}\hlstd{Spill.date}\hlkwb{<-}\hlkwd{as.Date}\hlstd{(table2f}\hlopt{$}\hlstd{Spill.date,}\hlstr{"%d-%b-%y"}\hlstd{)}
\hlstd{table2f}\hlopt{$}\hlstd{Sample.collection.date}\hlkwb{<-}\hlkwd{as.Date}\hlstd{(table2f}\hlopt{$}\hlstd{Sample.collection.date,}\hlstr{"%d.%m.%y"}\hlstd{)}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in as.Date.default(table2f\$Sample.collection.date, "{}\%d.\%m.\%y"{}): do not know how to convert 'table2f\$Sample.collection.date' to class "{}Date"{}}}\begin{alltt}
\hlcom{#sapply(table2f,mode)}
\hlkwd{sapply}\hlstd{(table2f,class)}
\end{alltt}
\begin{verbatim}
##         Group          Site     Sample.ID           Rep    Spill.date 
##   "character"     "numeric"     "numeric"   "character"        "Date" 
##      rowNames as.Data.frame 
##     "logical"     "logical"
\end{verbatim}
\end{kframe}
\end{knitrout}
\clearpage
\end{frame}

\begin{frame}[fragile, allowframebreaks]
  \frametitle{Lets read the next table}
  \framesubtitle{Setting the Date Type}
\begin{block}{colClasses}
\begin{itemize}
\item The as.Data method can take a format string as the second variable 
\item The format strings are described in help on  strptime
\item But Spill.data has {\bf two formats}
\item We can use the if else function to combine them
 \end{itemize}
 \end{block}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{table2bf}\hlkwb{<-}\hlstd{table2b}
\hlstd{table2bf}\hlopt{$}\hlstd{Spill.date}\hlkwb{<-}\hlkwd{as.Date}\hlstd{(table2bf}\hlopt{$}\hlstd{Spill.date,}\hlstr{"%d-%b-%y"}\hlstd{)}
\hlcom{#table2bf$Sample.collection.date<-as.Date(table2bf$Sample.collection.date,"%d.%m.%y")}
\hlstd{cdate1}\hlkwb{<-}\hlkwd{as.Date}\hlstd{(table2bf}\hlopt{$}\hlstd{Sample.collection.date,}\hlstr{"%d.%m.%y"}\hlstd{)}
\hlstd{cdate2}\hlkwb{<-}\hlkwd{as.Date}\hlstd{(table2bf}\hlopt{$}\hlstd{Sample.collection.date,}\hlstr{"%d/%m/%y"}\hlstd{)}
\hlstd{table2bf}\hlopt{$}\hlstd{Sample.collection.date}\hlkwb{<-}\hlkwd{as.Date}\hlstd{(}\hlkwd{ifelse}\hlstd{(}\hlopt{!}\hlkwd{is.na}\hlstd{(cdate1),}\hlkwd{as.Date}\hlstd{(cdate1),}\hlkwd{as.Date}\hlstd{(cdate2)),} \hlkwc{origin}\hlstd{=}\hlstr{"1970-01-01"}\hlstd{)}
\hlstd{table2bf}\hlopt{$}\hlstd{Group}\hlkwb{<-}\hlkwd{as.factor}\hlstd{(table2bf}\hlopt{$}\hlstd{Group)}
\hlstd{table2bf}\hlopt{$}\hlstd{Rep}\hlkwb{<-}\hlkwd{as.factor}\hlstd{(table2bf}\hlopt{$}\hlstd{Rep)}
\hlstd{na_count} \hlkwb{<-}\hlkwd{sapply}\hlstd{(table2bf,} \hlkwa{function}\hlstd{(}\hlkwc{y}\hlstd{)} \hlkwd{sum}\hlstd{(}\hlkwd{length}\hlstd{(}\hlkwd{which}\hlstd{(}\hlkwd{is.na}\hlstd{(y)))))}
\hlstd{na_count}
\end{alltt}
\begin{verbatim}
##                  Group                   Site              Sample.ID 
##                      0                      0                      0 
##                    Rep             Spill.date Sample.collection.date 
##                      0                     24                      0 
##                 labnum        phosphate..ppb.          ammonia..ppb. 
##                      0                      0                      0 
##     chlorophyll..ug.L.                 DO....               rowNames 
##                      0                      0                      0 
##          as.Data.frame 
##                      0
\end{verbatim}
\begin{alltt}
\hlstd{dated}\hlkwb{<-}\hlstd{table2bf}\hlopt{$}\hlstd{Sample.collection.date}\hlopt{-}\hlstd{table2bf}\hlopt{$}\hlstd{Spill.date}
\end{alltt}
\end{kframe}
\end{knitrout}
\clearpage
\end{frame}

\section*{Working with string}
\begin{frame}[fragile, allowframebreaks]
  \frametitle{How to work with strings}
  \framesubtitle{merge command}
\begin{itemize}
\item $require(stringer)$ %look at this package
\item $stri_c(str1,str2)$    concatenates two string
\item $str_len(str)$
\end{itemize}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{require}\hlstd{(stringr)}
\hlstd{table2bf}\hlopt{$}\hlstd{Rep}\hlkwb{<-}\hlkwd{str_replace}\hlstd{(table2bf}\hlopt{$}\hlstd{Rep,}\hlstr{"[rep]\{3\}?"}\hlstd{,}\hlstr{"\textbackslash{}\textbackslash{}1"}\hlstd{)}
\hlstd{table2bf}\hlopt{$}\hlstd{Rep}\hlkwb{<-}\hlkwd{str_replace}\hlstd{(table2bf}\hlopt{$}\hlstd{Rep,}\hlstr{"A"}\hlstd{,}\hlstr{"1"}\hlstd{)}
\hlstd{table2bf}\hlopt{$}\hlstd{Rep}\hlkwb{<-}\hlkwd{str_replace}\hlstd{(table2bf}\hlopt{$}\hlstd{Rep,}\hlstr{"B"}\hlstd{,}\hlstr{"2"}\hlstd{)}
\hlstd{table2bf}\hlopt{$}\hlstd{Rep}\hlkwb{<-}\hlkwd{str_replace}\hlstd{(table2bf}\hlopt{$}\hlstd{Rep,}\hlstr{"C"}\hlstd{,}\hlstr{"3"}\hlstd{)}
\hlstd{table2bf}\hlopt{$}\hlstd{Rep}\hlkwb{<-}\hlkwd{as.factor}\hlstd{(table2bf}\hlopt{$}\hlstd{Rep)}
\hlkwd{str}\hlstd{(table2bf)}
\end{alltt}
\begin{verbatim}
## 'data.frame':	48 obs. of  13 variables:
##  $ Group                 : Factor w/ 2 levels "Contaminated",..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Site                  : num  1 1 1 2 2 2 1 1 1 2 ...
##  $ Sample.ID             : num  10000 10001 10002 10003 10004 ...
##  $ Rep                   : Factor w/ 3 levels "1","2","3": 1 2 3 1 2 3 1 2 3 1 ...
##  $ Spill.date            : Date, format: "2014-05-14" "2014-05-14" ...
##  $ Sample.collection.date: Date, format: "2014-05-15" "2014-05-15" ...
##  $ labnum                : num  2000 2001 2002 2003 2004 ...
##  $ phosphate..ppb.       : num  3020 3253 3169 2999 2879 ...
##  $ ammonia..ppb.         : num  13880 14598 14676 10984 11657 ...
##  $ chlorophyll..ug.L.    : num  302 323 315 352 289 296 254 248 250 220 ...
##  $ DO....                : num  34 33 31 38 36 34 40 38 41 45 ...
##  $ rowNames              : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
##  $ as.Data.frame         : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}  

\section*{How to I merge two data sets}
\begin{frame}[fragile, allowframebreaks]
  \frametitle{How to I merge two data sets}
  \framesubtitle{Using the merge command}

\begin{block}{The inbuilt command merge}
\begin{itemize}
\item R has a command merge
\item Lets start looking at the first 9 lines of the tables and merge them using the Sample ID
\item Because otherwise its not uniques
\end{itemize}
\begin{lstlisting}
merge(x, y, by = intersect(names(x), names(y)),
      by.x = by, by.y = by, all = FALSE, all.x = all, all.y = all,
      sort = TRUE, suffixes = c(".x",".y"),
      incomparables = NULL, ...)
\end{lstlisting}
\end{block}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{tab1c}\hlkwb{<-}\hlstd{table1t[}\hlnum{1}\hlopt{:}\hlnum{9}\hlstd{,]}
\hlstd{tab2c}\hlkwb{<-}\hlstd{table2b[}\hlnum{1}\hlopt{:}\hlnum{9}\hlstd{,]}
\hlstd{m1}\hlkwb{<-}\hlkwd{merge}\hlstd{(tab1c,tab2c,}\hlkwc{by.x}\hlstd{=}\hlstr{"Sample ID"}\hlstd{,}\hlkwc{by.y}\hlstd{=}\hlstr{"Sample.ID"}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}  

\section*{Fat or wide}
\begin{frame}
  \frametitle{Reshaping Tables}
  \framesubtitle{reshape2}
  \begin{block}{reshape2}
  vignette(reshape)
  \end{block}
\end{frame}  

\begin{frame}
  \frametitle{How to I merge two data sets}
  \framesubtitle{Two primary keys}
  using RSQLite
\end{frame}


\begin{frame}
  \frametitle{R package}
  \framesubtitle{Rsqlite}
\end{frame}

\begin{frame}
  \frametitle{R package}
  \framesubtitle{svUnit}
     Another important component of TDD is refactoring and unit tests
  \begin{itemize}
     \item Refactoring {\url http://refactoring.com/}
     \item {\url http://www.r-bloggers.com/my-experience-of-learning-r-from-basic-graphs-to-performance-tuning/}
     \item TDD in R {\url http://www.slideserve.com/andrew/test-driven-development-in-r}
     \item Version Control tortiseSVN {\url http://tortoisesvn.net/}
     \item GitHub {\url https://github.com/}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Morning Tea Time}
  \framesubtitle{Back in 20min}
  Need coffee
\end{frame}

\begin{frame}
  \frametitle{How to I merge two data sets}
  \framesubtitle{What if the keys don't match}
\begin{block}{SQLite}
\begin{itemize}
\item dd
\end{itemize}
\end{block}

  
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
  \frametitle{Lunch Time}
  \framesubtitle{Back in 30 min}
  Provided
\end{frame}

\begin{frame}
  \frametitle{Adding a new column}
  \framesubtitle{Calculating the number of days}
  Using the $is.Date$ command
\end{frame}

\begin{frame}
  \frametitle{How to I append two data sets}
  %\framesubtitle{}
\end{frame}
\begin{frame}
  \frametitle{Another Break}
  %\framesubtitle{}
\end{frame}

\begin{frame}
  \frametitle{Now lets have some fun}
  \framesubtitle{Making a heat map}
\end{frame}

\begin{frame}
  \frametitle{What next}
  \framesubtitle{Proposed future talks}
  \begin{block}{Your feedback on some ideas}
  \begin{itemize}
  \item Using Sweave or Knitr
  \item Advanced Data Cleaning 
  \item Network Centric data analysis
  \end{itemize}
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{Resources}
  \framesubtitle{If you want to improve this style}
  \begin{thebibliography}{10}

  \beamertemplatearticlebibitems
%https://www.getdatajoy.com/
  \bibitem{beamer-homepage}
    LaTeX Beamer
    \newblock {\tt http://latex-beamer.sourceforge.net/}

  \bibitem{}
    Sharelatex Site % a link to my slides
    \newblock {\tt https://www.sharelatex.com}
  \bibitem{}
    A Data Cleaning Mooc % a link to my slides
    \newblock {\tt https://www.sharelatex.com}    
%    https://www.coursera.org/course/repdata
  \end{thebibliography}
\end{frame}

%\frame{
%  \vspace{2cm}
%  {\huge Questions ?}
%
%  \vspace{3cm}
%  \begin{flushright}
%    Peter Shaw
%
%    \structure{\footnotesize{peter.shaw@cdu.edu.au}}
%  \end{flushright}
%}


%You can type R commands in your \LaTeX{} document and they will be properly run and the output printed in the document.

%<<chunk1>>=
%# Create a sequence of numbers
%X = 2:10
%
%# Display basic statistical measures
%summary(X)
%
%@
%--------------------------------------------------------------------------------

%So, the mean of the data is $mean(X)$ %Inline command


%\clearpage
%Plots
%--------------------------------------------------------------------------------
%<<plot1, fig.pos="t", fig.height=4, fig.width=4, fig.cap="First plot">>=

%xdata = read.csv(file="data.txt", head=TRUE,sep=" ")

%hist(xdata$data, main="ShareLaTeX histogram", xlab="Data")

%@
%--------------------------------------------------------------------------------

%The figure \ref{fig:plot1} is simple histogram.

%\clearpage

The chunk below will not be printed

%R code imported from external file
%--------------------------------------------------------------------------------
%<<echo=FALSE, cache=FALSE>>=
%read_chunk("mycode.R")
%@

%The code must show up here

%<<myrcode2>>=

%@
%--------------------------------------------------------------------------------


%\frame{
%  \vspace{2cm}
%  {\huge Questions ?}

%  \vspace{3cm}
%  \begin{flushright}
%    Peter Shaw

%    \structure{\footnotesize{peter.shaw@cdu.edu.au}}
%  \end{flushright}
%}
\end{document}
